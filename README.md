# Data-Analytics Dashboard for Flowbit

A production-grade full-stack web application featuring an interactive analytics dashboard and a "Chat with Data" interface, built for the Flowbit Private Limited internship assessment.

---

## üîó Live Demo Links

*   **Frontend (Vercel):** [https://flowbit-task-garvit.vercel.app/](https://flowbit-task-garvit.vercel.app/)
*   **Vanna AI Service (Render):** [https://my-app-vanna.onrender.com](https://my-app-vanna.onrender.com)

---

## ‚ú® Features

*   **Interactive Analytics Dashboard:** Pixel-perfect recreation of the Figma design with dynamic data.
*   **Real-time Metrics:** Overview cards for Total Spend (YTD), Invoices Processed, and Average Invoice Value.
*   **Dynamic Charts:** Line, Bar, and Pie charts visualizing invoice trends, spend by vendor, and spend by category.
*   **Searchable & Sortable Invoice Table:** A comprehensive table with live search and sorting capabilities.
*   **"Chat with Data" Interface:** Natural language querying of the database powered by a self-hosted Vanna AI and Groq LLM.
*   **SQL Generation Display:** Shows the SQL query generated by the AI for transparency.
*   **Monorepo Architecture:** Cleanly structured using Turborepo for scalable development.

---

## üõ†Ô∏è Tech Stack

| Category      | Technology                                    |
|---------------|-----------------------------------------------|
| Monorepo      | Turborepo                                     |
| Frontend      | Next.js (App Router), TypeScript, Tailwind CSS, shadcn/ui |
| Charting      | Recharts                                      |
| Backend       | Next.js API Routes, Node.js, TypeScript       |
| Database      | PostgreSQL                                    |
| ORM           | Drizzle                                       |
| AI Layer      | Self-hosted Vanna AI (FastAPI), Groq          |
| Deployment    | Vercel (Frontend + Backend), Render (Vanna AI)|

---

## üèóÔ∏è Architecture & Workflow

### "Chat with Data" Flow

1.  **Frontend:** A user types a question ("*List top 5 vendors*") into the chat interface and submits it.
2.  **Next.js API (`/api/chat-with-data`):** The frontend calls this internal API endpoint, which acts as a secure proxy.
3.  **Vanna AI Service:** The Next.js API forwards the request to the self-hosted Python Vanna AI service.
4.  **SQL Generation (Vanna + Groq):** Vanna uses its training data (the database schema) to construct a prompt for Groq, which then generates the appropriate SQL query.
5.  **Database Query:** Vanna executes the generated SQL against the PostgreSQL database.
6.  **Response:** The query result is returned to Vanna, which packages it into a JSON object (including the SQL query and the data) and sends it back down the chain to the frontend.
7.  **Display:** The frontend parses the JSON and displays the generated SQL and the data results in a table.

---

## üöÄ Getting Started Locally

### Prerequisites

*   Node.js (`v20.x` recommended)
*   `npm`
*   PostgreSQL
*   A Groq API Key

### 1. Clone the Repository

```bash
git clone https://github.com/Garvit-Pahwa-03/Flowbit-task
cd Flowbit-task
2. Set Up Environment Variables
Create a .env file in /apps/api and /services/vanna. Use the .env.example files in those directories as a template.
/apps/api/.env:
code
Env
DATABASE_URL="postgresql://USER:PASSWORD@HOST:PORT/DATABASE"
VANNA_API_BASE_URL="http://localhost:8000" # Default local Vanna URL
/services/vanna/.env:
code
Env
# For Vanna's Python psycopg driver
DATABASE_URL="postgresql+psycopg://USER:PASSWORD@HOST:PORT/DATABASE"
GROQ_API_KEY="your-groq-api-key"
PORT=8000
3. Install Dependencies
From the root directory of the project, run:
code
Bash
npm install
4. Set Up the Database
Ensure your PostgreSQL server is running and you have created a database. Then, run the migration and seed scripts from the root directory:
code
Bash
# Apply the database schema
npm run db:migrate

# Seed the database with the provided JSON data
npm run db:seed
5. Run the Application
Run all parts of the monorepo concurrently from the root directory:
code
Bash
npm run dev
The application will be available at:
Frontend: http://localhost:3000
Vanna AI Service: http://localhost:8000
üìÑ Database Schema
The database is designed to normalize the nested JSON data into a relational structure.
vendors: Stores unique vendor information.
categories: Stores spending categories (Sachkonto).
invoices: The central table for all invoice-level data, linked to a vendor.
lineItems: Contains individual line items for each invoice, linked to categories.
documents: Stores metadata about the source document and a copy of the raw JSON data for auditing.
The relationships (one-to-many, one-to-one) are defined using Drizzle ORM to ensure data integrity and enable efficient joins. The complete schema can be viewed in /packages/db/schema.ts.
‚öôÔ∏è API Endpoints
GET /api/stats
Description: Returns totals for the overview cards on the dashboard.
Example Response:
code
JSON
{
  "totalSpendYTD": "5.046,42",
  "totalInvoicesProcessed": 49,
  "documentsUploadedThisMonth": 11,
  "averageInvoiceValue": "614,88"
}
GET /api/invoice-trends
Description: Returns monthly invoice counts and total spend for the line chart.
Example Response:
code
JSON
{
  "labels": ["2014-05", "2015-08", "2020-01", "2020-05", "..."],
  "invoiceCounts": [1, 1, 1, 1, "..."],
  "totalSpends": [312.96, 1190, 3653.3, 4645, "..."]
}
GET /api/vendors/top10
Description: Returns the top 10 vendors by total spend.
Example Response:
code
JSON
[
  {
    "vendorName": "CPB SOFTWARE (GERMANY) GMBH",
    "totalSpend": "14101.44"
  },
  {
    "vendorName": "EasyFirma GmbH & Co KG",
    "totalSpend": "5680.00"
  }
]
GET /api/category-spend
Description: Returns total spend grouped by category for the pie chart.
Example Response:
code
JSON
[
  {
    "category": "Account 4400",
    "totalSpend": "7087.15"
  },
  {
    "category": "Account 4910",
    "totalSpend": "2294.90"
  }
]
GET /api/cash-outflow
Description: Returns expected cash outflow data for the forecast chart.
Example Response:
code
JSON
[
  { "range": "0-7 days", "totalAmount": "0.00" },
  { "range": "8-30 days", "totalAmount": "0.00" },
  { "range": "31-60 days", "totalAmount": "0.00" },
  { "range": "60+ days", "totalAmount": "0.00" }
]
GET /api/invoices
Description: Returns a list of invoices, supporting filtering and searching.
Example Response:
code
JSON
[
  {
    "id": 9,
    "invoiceNumber": "1234",
    "vendorId": 9,
    "status": "processed",
    "invoiceDate": "2025-11-04",
    "totalAmount": "-358.79",
    "vendor": {
      "id": 9,
      "name": "Musterfirma M√ºller"
    }
  }
]
POST /api/chat-with-data
Description: Forwards a natural language query to the Vanna AI service.
Request Body: {"question": "List top 5 vendors by spend"}
Example Response (from Vanna):
code
JSON
{
  "sql": "SELECT \n    v.name, \n    SUM(li.total_price) AS total_spend\nFROM \n    vendors v\nJOIN \n    invoices i ON v.id = i.vendor_id\nJOIN \n    line_items li ON i.id = li.invoice_id\nGROUP BY \n    v.name\nORDER BY \n    total_spend DESC\nLIMIT 5;",
  "result": [
    {"name": "CPB SOFTWARE (GERMANY) GMBH", "total_spend": "14101.44"},
    {"name": "EasyFirma GmbH & Co KG", "total_spend": "6318.50"},
    {"name": "ABC Seller", "total_spend": "4357.60"},
    {"name": "pixa", "total_spend": "3070.00"},
    {"name": "Taxon GmbH", "total_spend": "541.45"}
  ]
}
‚ö†Ô∏è Project Notes
1. "Chat With Data" Deployment Status
The "Chat with Data" feature is fully functional in the local development environment. However, due to time constraints, I encountered issues with the environment configuration for the deployed Vanna AI service on Render, which currently prevents the chat from working correctly on the live Vercel deployment. The local setup instructions provide a reliable way to test this feature's full capabilities.
2. Cash Outflow Forecast Data
The "Cash Outflow Forecast" component and its corresponding backend API (/api/cash-outflow) are fully implemented and function correctly. The chart appears empty because the provided dataset, Analytics_Test_Data.json, is a historical snapshot and contains no invoices with future due dates. The API logic correctly queries the database for invoices where the status is not paid and the dueDate is on or after today's date. Since no records in the dataset match these criteria, the API correctly returns an empty data array, and the chart correctly renders an empty state.
üßë‚Äçüíª Author
Name: Garvit Pahwa
GitHub: https://github.com/Garvit-Pahwa-03
LinkedIn: https://www.linkedin.com/in/garvit-pahwa-3aa7b3315/
